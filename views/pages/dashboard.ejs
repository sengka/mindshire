<div class="fixed-background"></div>

<main class="dashboard-page">
  <!-- ÃœST KARÅILAMA BLOÄU -->
  <section class="dashboard-hero">
    <div class="dashboard-hero-text">
      <h1 class="dashboard-title">
        Tekrar hoÅŸ geldin, <span>
          <%= user.username %>
        </span>!
      </h1>
      <p class="dashboard-subtitle">
        AsanÄ± hazÄ±rla, bugÃ¼n hangi bÃ¼yÃ¼ Ã¼zerinde Ã§alÄ±ÅŸacaÄŸÄ±z?
      </p>

      <div class="hero-tags">
        <span class="hero-tag">ğŸ“š OdaklÄ± Ã§alÄ±ÅŸma</span>
        <span class="hero-tag">â³ KÃ¼Ã§Ã¼k adÄ±mlar, bÃ¼yÃ¼k bÃ¼yÃ¼ler</span>
        <span class="hero-tag">âœ¨ Ä°lerleme her gÃ¼n bir parÃ§a</span>
      </div>
    </div>

    <% const doneToday=user.dashboard?.completedTasksToday ?? 0; const totalToday=user.dashboard?.totalTasksToday ?? 0;
      %>

      <div class="dashboard-quick-stats">
        <div class="quick-card">
          <div class="quick-label">BugÃ¼nkÃ¼ gÃ¶rev</div>
          <div class="quick-value">
            <%= doneToday %> / <%= totalToday %>
          </div>
          <div class="quick-note">Tamamlanan gÃ¶rev sayÄ±sÄ±</div>
        </div>

        <!-- Pomodoro/Streak ÅŸimdilik dummy kalsÄ±n -->
        <div class="quick-card">
          <div class="quick-label">Toplam Pomodoro</div>
          <div class="quick-value">
            <%= stats.todayPomodoros || 0 %>
          </div>
          <div class="quick-note">BugÃ¼nkÃ¼ odak seansÄ±</div>
        </div>
        <div class="quick-card">
          <div class="quick-label">Streak</div>
          <div class="quick-value">
            <%= stats.currentStreak || 0 %> gÃ¼n
          </div>
          <div class="quick-note">AralÄ±ksÄ±z Ã§alÄ±ÅŸma serisi</div>
        </div>
      </div>
  </section>

  <!-- ANA GRID -->
  <section class="dashboard-grid">
    <!-- Sol sÃ¼tun: BugÃ¼nkÃ¼ gÃ¶revler -->
    <div class="dash-panel panel-today">
      <div class="panel-header">
        <h2>BugÃ¼nkÃ¼ GÃ¶revler</h2>
        <a href="/todo" class="panel-link">TÃ¼mÃ¼nÃ¼ gÃ¶r â†’</a>
      </div>

      <ul class="task-list">
        <% if (user.dashboard?.todaysTasks && user.dashboard.todaysTasks.length) { %>
          <% user.dashboard.todaysTasks.forEach(t=> { %>
            <li class="task-item <%= t.isCompleted ? 'is-done' : '' %>">
              <span class="task-dot"></span>

              <div class="task-text">
                <span class="task-title">
                  <%= t.title %>
                    <% if (t.isCompleted) { %>
                      <span class="task-done-label">âœ“</span>
                      <% } %>
                </span>

                <span class="task-meta">
                  â± <%= t.duration %> dk Â· <%= t.category %>
                </span>
              </div>
            </li>
            <% }) %>
              <% } else { %>
                <li class="task-item">
                  <span class="task-dot"></span>
                  <div class="task-text">
                    <span class="task-title">BugÃ¼n iÃ§in gÃ¶rev yok âœ¨</span>
                    <span class="task-meta">To-Do sayfasÄ±ndan ekleyebilirsin</span>
                  </div>
                </li>
                <% } %>
      </ul>

      <button class="btn-dashboard-primary" onclick="window.location.href='/todo'">
        + Yeni gÃ¶rev ekle
      </button>
    </div>

    <!-- Orta sÃ¼tun: Pomodoro / Odak modu -->
    <div class="dash-panel panel-focus" onclick="window.location.href='/study-room/personal'" style="cursor: pointer;">
      <div class="panel-header">
        <h2>Odak Modu</h2>
        <span class="panel-note">Pomodoro ile kÃ¼Ã§Ã¼k bÃ¼yÃ¼ler yap</span>
      </div>

      <div class="focus-timer">
        <div class="focus-time">25:00</div>
        <div class="focus-label">Bir sonraki odak turu</div>
        <div class="focus-buttons">
          <button class="btn-dashboard-primary"
            onclick="event.stopPropagation(); window.location.href='/study-room/personal'">BaÅŸlat</button>
          <button class="btn-dashboard-ghost"
            onclick="event.stopPropagation(); window.location.href='/study-room/personal'">KÄ±sa mola</button>
          <button class="btn-dashboard-ghost"
            onclick="event.stopPropagation(); window.location.href='/study-room/personal'">Uzun mola</button>
        </div>
      </div>

      <div class="focus-footer">
        <span>ğŸ”” HatÄ±rlatma: Ã‡alÄ±ÅŸma odanÄ± sessize al, suyun yanÄ±nda olsun.</span>
      </div>
    </div>

    <!-- SaÄŸ sÃ¼tun: Takvim + Ä°statistik Ã¶nizlemesi -->
    <div class="dash-panel panel-side">
      <div class="panel-header">
        <h2>YaklaÅŸanlar</h2>
        <a href="/calendar" class="panel-link">Takvimi aÃ§ â†’</a>
      </div>

      <ul class="upcoming-list">
        <% if (typeof upcomingEvents !=='undefined' && upcomingEvents && upcomingEvents.length> 0) { %>
          <% upcomingEvents.forEach(function(event) { %>
            <% var eventDate=new Date(event.date); var day=eventDate.getDate(); var monthNames=['Oca', 'Åub' , 'Mar'
              , 'Nis' , 'May' , 'Haz' , 'Tem' , 'AÄŸu' , 'Eyl' , 'Eki' , 'Kas' , 'Ara' ]; var
              month=monthNames[eventDate.getMonth()]; var icon='ğŸ“…' ; if (event.type==='exam' ) { icon='ğŸ“' ; } else if
              (event.type==='deadline' ) { icon='â°' ; } else if (event.type==='reminder' ) { icon='ğŸ””' ; } var meta='' ;
              if (event.time) meta +=icon + ' ' + event.time; if (event.location) meta +=(meta ? ' Â· ' : '' ) + 'ğŸ“ ' +
              event.location; if (!meta) meta=icon + ' TÃ¼m gÃ¼n' ; %>
              <li class="upcoming-item">
                <span class="upcoming-date">
                  <%= day %>
                    <%= month %>
                </span>
                <div class="upcoming-text">
                  <span class="upcoming-title">
                    <%= event.title %>
                  </span>
                  <span class="upcoming-meta"><%- meta %></span>
                </div>
              </li>
              <% }); %>
                <% } else { %>
                  <li class="upcoming-item">
                    <span class="upcoming-date">--</span>
                    <div class="upcoming-text">
                      <span class="upcoming-title">YaklaÅŸan etkinlik yok</span>
                      <span class="upcoming-meta">Takvimden yeni etkinlik ekleyebilirsin</span>
                    </div>
                  </li>
                  <% } %>
      </ul>

      <div class="panel-divider"></div>

      <div class="panel-header">
        <h2>Ä°lerleme Ã–zeti</h2>
        <a href="/stats" class="panel-link">DetaylÄ± istatistik â†’</a>
      </div>

      <div class="progress-summary">
        <div class="progress-row">
          <span>Bu hafta Ã§alÄ±ÅŸma sÃ¼resi</span>
          <span>
            <%= stats.weeklyDuration || '0 dk' %>
          </span>
        </div>
        <div class="progress-row">
          <span>Tamamlanan gÃ¶rev</span>
          <span>
            <%= stats.weeklyTasks || 0 %> gÃ¶rev
          </span>
        </div>
        <div class="progress-row">
          <span>En aktif ders</span>
          <span>
            <%= stats.topCategory || 'HenÃ¼z yok' %>
          </span>
        </div>
      </div>
    </div>
  </section>
</main>